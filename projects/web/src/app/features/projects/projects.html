<app-header></app-header>

<div class="projects-container">
  <div class="projects-header">
    <div class="header-content">
      <div class="header-title">
        <h1>Proyectos</h1>
        <p class="text-muted">Gestiona tus modelos de datos y colabora con tu equipo</p>
      </div>

      <div class="workspace-selector">
        <app-form-field label="Workspace actual">
          <select [value]="selectedWsId()" (change)="onWsChanged($event)">
            <option *ngFor="let ws of workspaces()" [value]="ws.id">
              {{ ws.name }} ({{ ws.role }}) · {{ ws.projectCount }} proyectos
            </option>
          </select>
        </app-form-field>
        <button type="button" class="btn-outline" (click)="reload()" [disabled]="loading()">
          Recargar
        </button>
      </div>
    </div>
  </div>

  <div class="projects-content">
    <div *ngIf="error()" class="error-banner"><strong>Error:</strong> {{ error() }}</div>

    <app-card title="Crear nuevo proyecto" class="create-project-card">
      <form [formGroup]="form" (ngSubmit)="create()">
        <div class="form-grid">
          <app-form-field
            label="Nombre del proyecto"
            [error]="
              form.controls.name.invalid && form.controls.name.touched
                ? 'El nombre es requerido (mín. 2 caracteres)'
                : undefined
            "
            required
          >
            <input type="text" formControlName="name" placeholder="Mi proyecto de datos" />
          </app-form-field>

          <app-form-field label="Descripción" hint="Opcional">
            <input
              type="text"
              formControlName="description"
              placeholder="Descripción del proyecto..."
            />
          </app-form-field>

          <app-form-field label="Tags" hint="Separados por comas">
            <input type="text" formControlName="tags" placeholder="backend, api, usuarios" />
          </app-form-field>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary" [disabled]="form.invalid || loading()">
            {{ loading() ? 'Creando...' : 'Crear proyecto' }}
          </button>
        </div>
      </form>
    </app-card>

    <div class="projects-grid">
      <app-card *ngFor="let project of projects()" [hover]="true" class="project-card">
        <div slot="header" class="project-header">
          <div class="project-info">
            <h3 class="project-name">{{ project.name }}</h3>
            <span class="project-status" [class]="'status-' + project.status.toLowerCase()">
              {{ project.status }}
            </span>
          </div>
        </div>

        <div class="project-content">
          <p *ngIf="project.description" class="project-description">
            {{ project.description }}
          </p>

          <div class="project-tags" *ngIf="project.tags?.length">
            <span class="tag" *ngFor="let pt of project.tags">
              {{ pt.tag?.name }}
            </span>
          </div>

          <div class="project-actions">
            <a [routerLink]="['/app/projects', project.id, 'editor']" class="btn-primary btn-sm">
              Editar modelo
            </a>
            <a class="btn-primary btn-sm" [routerLink]="['/app/projects', project.id, 'artifacts']">
              Artefactos
            </a>
            <a
              [routerLink]="['/app/projects', project.id, 'collaborators']"
              class="btn-outline btn-sm"
            >
              Colaboradores
            </a>
            <a [routerLink]="['/app/projects', project.id, 'versions']" class="btn-outline btn-sm">
              Versiones
            </a>
          </div>
        </div>

        <div slot="footer" class="project-footer">
          <div class="project-meta">
            <small class="text-muted">Última actualización: hace 2 días</small>
          </div>
          <div class="project-controls">
            <button
              *ngIf="project.status === 'ACTIVE'"
              (click)="archive(project.id)"
              class="btn-outline btn-xs"
            >
              Archivar
            </button>
            <button
              *ngIf="project.status === 'ARCHIVED'"
              (click)="restore(project.id)"
              class="btn-secondary btn-xs"
            >
              Restaurar
            </button>
            <button
              (click)="remove(project.id)"
              class="btn-outline btn-xs text-error"
              onclick="return confirm('¿Estás seguro de eliminar este proyecto?')"
            >
              Eliminar
            </button>
          </div>
        </div>
      </app-card>
    </div>

    <div *ngIf="projects().length === 0 && !loading()" class="empty-state">
      <div class="empty-content">
        <h3>No hay proyectos</h3>
        <p class="text-muted">Crea tu primer proyecto para comenzar a modelar datos</p>
      </div>
    </div>

    <div *ngIf="loading()" class="loading-state">
      <p>Cargando proyectos...</p>
    </div>
  </div>
</div>
